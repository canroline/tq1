(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/component/audio/shopBag/shopBag"],{"4e3d":function(o,t,e){"use strict";e.r(t);var n=e("d8f4"),a=e("ba92");for(var s in a)"default"!==s&&function(o){e.d(t,o,function(){return a[o]})}(s);var i=e("2877"),c=Object(i["a"])(a["default"],n["a"],n["b"],!1,null,null,null);t["default"]=c.exports},"7b7d":function(o,t,e){"use strict";(function(o){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(){return e.e("components/uni-number-box/uni-number-box").then(e.bind(null,"6258"))},a={components:{uniNumberBox:n},data:function(){return{check_all:!0,orderCarList:[],val:1,IPData:{},wxPayData:{}}},computed:{sumMoney:function(){var o=this.$store.state.Add,t=this.$store.state.Multiply,e=0;return this.orderCarList.forEach(function(n){n.checked&&(e=o(t(Number(n.goods_price),Number(n.goods_num)),e))}),e}},onShow:function(t){var e=this;this.$store.state.orderCarList.length<1?this.$store.dispatch("getBagList").then(function(o){console.log("获取购物车列表 getBagList=",o)}).catch(function(t){o.showToast({title:t,icon:"none",duration:2e3})}):this.orderCarList=this.$store.state.orderCarList,setTimeout(function(){e.inited=!0,console.log("inited !!!!")},1e3),console.log(">>>>onShow")},methods:{getIP:function(){var t=this;o.request({url:"http://pv.sohu.com/cityjson?ie=utf-8",dataType:"script",method:"GET",header:{"content-type":"application/json"},success:function(o){console.log("获取IP=",o),console.log("data=",o.data,o.data.split(" = ")[1]),t.IPData=JSON.parse(o.data.split(" = ")[1].replace(";","")),console.log("this.IPData=",t.IPData)}})},ListCheck:function(o){console.log("ListCheck =",o);var t=o.detail.value;t.length==this.orderCarList.length?this.check_all=!0:this.check_all=!1,this.orderCarList.forEach(function(o){t.includes(o.goods_no)?o.checked=!0:o.checked=!1}),console.log("this.orderCarList =",this.orderCarList)},allCheck:function(o){console.log("allCheck =",o,this.check_all);var t=o.detail.value,e=!1;t.includes("all")&&(e=!0),this.orderCarList.forEach(function(o){o.checked=e}),console.log("this.orderCarList =",this.orderCarList)},changeNum:function(o,t){console.log("bindChange val=",o,t),o<1||(this.flag=o>t.goods_num?1:2,t.goods_num=o,this.inited&&this.addBag(t,o))},addBag:function(t,e){o.showLoading({title:"添加中"});var n={goods_no:t.goods_no,goods_model:t.goods_model,goods_num:e,goods_name:t.goods_name,openid:this.$store.state.sysOpenid,goods_price:t.goods_price,flag:this.flag};this.$store.dispatch("addBag",n).then(function(e){console.log("shopBag res =",e),0!=e.code&&(e.stock&&t.goods_num>e.stock&&(t.goods_num=e.stock),o.showToast({title:e.msg||"添加购物车失败！",icon:"none",duration:2e3}))}).catch(function(e){e.stock&&t.goods_num>e.stock&&(t.goods_num=e.stock),o.showToast({title:e.msg||"添加购物车失败！",icon:"none",duration:2e3})})},payOrder:function(){0!=this.sumMoney?this.pay():o.showToast({title:"暂无商品需要付款！",icon:"none",duration:2e3})},pay:function(){var t=this,e=this.$store.state.sysOpenid,n=.1,a=[];this.orderCarList.forEach(function(o){if(o.checked){var t={good_num:o.goods_num,good_no:o.goods_no,amt:o.goods_price,good_name:o.goods_name,good_model:o.goods_model};a.push(t)}}),a.length<1?o.showToast({title:"请选择要支付的商品！！",icon:"none",duration:2e3}):(o.showLoading({title:"付款中..."}),o.request({url:"https://feiwuar.goho.co/pay/wxGzPayOrder",data:{openid:e,price:n,allList:JSON.stringify(a),ip:this.$store.state.IPData.cip},method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},success:function(s){console.log("付钱 pay=",s,e,n,a,t.IPData.cip),200==s.statusCode&&"0000"==s.data.code?(t.wxPayData=s.data,t.GoWXPay()):(o.hideLoading(),o.showToast({title:"创建订单失败！",icon:"none",duration:2e3}))}}))},GoWXPay:function(){var t=this;o.requestPayment({provider:"wxpay",timeStamp:this.wxPayData.timeStamp,nonceStr:this.wxPayData.nonceStr,package:"prepay_id="+this.wxPayData.prepay_id,signType:this.wxPayData.signType,paySign:this.wxPayData.paySign,success:function(e){o.hideLoading(),console.log("GoWXPay success:"+JSON.stringify(e));var n="/pages/component/audio/shopBag/PayPage/PayPage?payCode=";o.navigateTo({url:n+0+"&msg="+e.errMsg}),t.$store.dispatch("getBagList")},fail:function(e){console.log("GoWXPay fail:"+JSON.stringify(e)),o.hideLoading();var n="/pages/component/audio/shopBag/PayPage/PayPage?payCode=";o.navigateTo({url:n+1+"&msg="+e.errMsg}),t.updateStock()}})},updateStock:function(){this.$store.dispatch("updateStock",this.wxPayData.order_no)},GoHome:function(){o.navigateTo({url:"/pages/tabBar/component/component"})},GoScan:function(){o.scanCode({success:function(t){console.log("条码类型："+t.scanType),console.log("条码内容："+t.result);var e=t.result;e?(console.log("goods_no："+e),o.request({url:"https://feiwuar.goho.co/pay/queryGoodsInfos",data:{goods_no:e},method:"GET",header:{"content-type":"application/x-www-form-urlencoded"},success:function(t){if(console.log("queryGoodsInfos=",t.data),"0000"==t.data.code){var e=encodeURIComponent(JSON.stringify(t.data.goodinfo)),n=encodeURIComponent(JSON.stringify(t.data.modelList));o.navigateTo({url:"/pages/component/audio/goodDetail/goodDetail?goodInfo="+e+"&modelInfo="+n})}else o.showToast({title:"获取商品信息失败！",icon:"none",duration:2e3})}})):o.showToast({title:"请检查二维码是否正确！",icon:"none",duration:2e3})}})}}};t.default=a}).call(this,e("543d")["default"])},ba92:function(o,t,e){"use strict";e.r(t);var n=e("7b7d"),a=e.n(n);for(var s in n)"default"!==s&&function(o){e.d(t,o,function(){return n[o]})}(s);t["default"]=a.a},d8f4:function(o,t,e){"use strict";var n=function(){var o=this,t=o.$createElement;o._self._c},a=[];e.d(t,"a",function(){return n}),e.d(t,"b",function(){return a})}},[["f5d0","common/runtime","common/vendor"]]]);