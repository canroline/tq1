(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/component/audio/shopBag/shopBag"],{4108:function(o,t,e){"use strict";e.r(t);var n=e("5963"),a=e.n(n);for(var s in n)"default"!==s&&function(o){e.d(t,o,function(){return n[o]})}(s);t["default"]=a.a},5963:function(o,t,e){"use strict";(function(o){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(){return e.e("components/uni-number-box/uni-number-box").then(e.bind(null,"c0f1"))},a={components:{uniNumberBox:n},data:function(){return{check_all:!0,orderCarList:[],wxPayData:{},no_bag_data:!1,inited:0,host_url:this.$store.state.host_url}},computed:{sumMoney:function(){var o=this.$store.state.Add,t=this.$store.state.Multiply,e=0;return this.orderCarList.forEach(function(n){n.checked&&(e=o(t(Number(n.goods_price),Number(n.goods_num)),e))}),e}},onShow:function(t){var e=this;o.showLoading({title:"获取中..."}),this.$store.dispatch("getBagList").then(function(t){console.log("获取购物车列表 getBagList=",t),o.hideLoading(),e.orderCarList=e.$store.state.orderCarList,e.orderCarList.length<1&&(e.no_bag_data=!0)}).catch(function(t){o.hideLoading(),e.no_bag_data=!0,o.showToast({title:t,icon:"none",duration:2e3})})},methods:{ListCheck:function(o){console.log("ListCheck =",o);var t=o.detail.value;t.length==this.orderCarList.length?this.check_all=!0:this.check_all=!1,this.orderCarList.forEach(function(o){t.includes(o.goods_no+"_"+o.goods_model)?o.checked=!0:o.checked=!1}),console.log("this.orderCarList =",this.check_all,this.orderCarList)},allCheck:function(o){console.log("allCheck =",o,this.check_all);var t=o.detail.value,e=!1;t.includes("all")&&(e=!0),this.check_all=e,this.orderCarList.forEach(function(o){o.checked=e}),console.log("this.orderCarList =",this.orderCarList)},changeNum:function(o,t){console.log("bindChange val=",o,t,this.inited),o<1||(this.flag=o>t.goods_num?1:2,t.goods_num=o,this.inited<this.orderCarList.length?this.inited=this.inited+1:(console.log("bindChange inited=",this.inited),this.addBag(t,o)))},addBag:function(t,e){o.showLoading({title:"添加中"});var n={goods_no:t.goods_no,goods_model:t.goods_model,goods_num:e,goods_name:t.goods_name,openid:this.$store.state.sysOpenid,goods_price:t.goods_price};this.$store.dispatch("addBag",n).then(function(o){console.log("shopBag res =",o),0!=o.code&&o.stock&&t.goods_num>o.stock&&(t.goods_num=o.stock)}).catch(function(o){o.stock&&t.goods_num>o.stock&&(t.goods_num=o.stock)})},payOrder:function(){0!=this.sumMoney?this.pay():o.showToast({title:"暂无商品需要付款！",icon:"none",duration:2e3})},pay:function(){var t=this,e=this.$store.state.sysOpenid,n=.1,a=[];this.orderCarList.forEach(function(o){if(o.checked){var t={good_num:o.goods_num,good_no:o.goods_no,amt:o.goods_price,good_name:o.goods_name,good_model:o.goods_model};a.push(t)}}),a.length<1?o.showToast({title:"请选择要支付的商品！！",icon:"none",duration:2e3}):(o.showLoading({title:"付款中..."}),o.request({url:this.host_url+"/pay/wxArPayOrder",data:{openid:e,price:n,allList:JSON.stringify(a)},method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},success:function(s){console.log("付钱 pay=",s,e,n,a),200==s.statusCode&&"0000"==s.data.code?(t.wxPayData=s.data,t.GoWXPay()):(o.hideLoading(),o.showToast({title:"创建订单失败！",icon:"none",duration:2e3}))}}))},GoWXPay:function(){var t=this,e="/pages/component/audio/shopBag/PayPage/PayPage?payCode=";o.requestPayment({provider:"wxpay",timeStamp:this.wxPayData.timeStamp,nonceStr:this.wxPayData.nonceStr,package:"prepay_id="+this.wxPayData.prepay_id,signType:this.wxPayData.signType,paySign:this.wxPayData.paySign,success:function(n){o.hideLoading(),console.log("GoWXPay success:"+JSON.stringify(n)),o.navigateTo({url:e+0+"&msg="+n.errMsg}),t.$store.dispatch("getBagList")},fail:function(n){console.log("GoWXPay fail:"+JSON.stringify(n)),o.hideLoading(),o.navigateTo({url:e+1+"&msg="+n.errMsg}),t.updateStock()}})},updateStock:function(){this.$store.dispatch("updateStock",this.wxPayData.order_no)},GoHome:function(){o.reLaunch({url:"/pages/tabBar/component/component"})},GoScan:function(){o.scanCode({success:function(t){console.log("条码类型："+t.scanType),console.log("条码内容："+t.result);var e=t.result;e?(console.log("goods_no："+e),o.request({url:this.host_url+"/pay/queryGoodsInfos",data:{goods_no:e},method:"GET",header:{"content-type":"application/x-www-form-urlencoded"},success:function(t){if(console.log("queryGoodsInfos=",t.data),"0000"==t.data.code){var e=encodeURIComponent(JSON.stringify(t.data.goodinfo)),n=encodeURIComponent(JSON.stringify(t.data.modelList));o.navigateTo({url:"/pages/component/audio/goodDetail/goodDetail?goodInfo="+e+"&modelInfo="+n})}else o.showToast({title:"获取商品信息失败！",icon:"none",duration:2e3})}})):o.showToast({title:"请检查二维码是否正确！",icon:"none",duration:2e3})}})}}};t.default=a}).call(this,e("543d")["default"])},ec67:function(o,t,e){"use strict";e.r(t);var n=e("f9f2"),a=e("4108");for(var s in a)"default"!==s&&function(o){e.d(t,o,function(){return a[o]})}(s);var i=e("2877"),d=Object(i["a"])(a["default"],n["a"],n["b"],!1,null,null,null);t["default"]=d.exports},f9f2:function(o,t,e){"use strict";var n=function(){var o=this,t=o.$createElement;o._self._c},a=[];e.d(t,"a",function(){return n}),e.d(t,"b",function(){return a})}},[["810f","common/runtime","common/vendor"]]]);